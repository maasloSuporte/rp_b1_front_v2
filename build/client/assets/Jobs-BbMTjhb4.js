import{r as s,v as S,j as e,K as N,h as v,E as I}from"./vendor-react-D3RE0R8o.js";import{d as k}from"./vendor-router-C5YTkdq4.js";import{j as w}from"./job.service-KAjP6H4k.js";import{u as P}from"./notification.service-CvsIel6B.js";import{D as T}from"./DynamicTable-BPyWbqtX.js";import{p as C}from"./projects.service-AnNXoBpb.js";import{p as E}from"./priority.service-CsXr_6UM.js";import{d as q}from"./devices.service-BEkRjjz1.js";import"./api-BB9j10S9.js";function F({isOpen:n,onClose:i}){const[f,p]=s.useState([]),[x,b]=s.useState([]),[m,y]=s.useState([]),[c,o]=s.useState(!1),{register:l,handleSubmit:h,formState:{errors:a},reset:u}=S({defaultValues:{name:"",projectId:0,priorityId:0,machineId:0}});s.useEffect(()=>{n&&(j(),u())},[n,u]);const j=async()=>{try{const[t,r,d]=await Promise.all([C.getProjects(),E.getPriority(),q.getDevices()]);p(t),b(r),y(d)}catch(t){console.error("Erro ao carregar dados:",t)}},g=async t=>{if(!(t.projectId===0||t.priorityId===0||t.machineId===0)){o(!0);try{i({name:t.name,projectId:t.projectId,priorityId:t.priorityId,machineId:t.machineId})}catch(r){console.error("Erro ao criar job:",r)}finally{o(!1)}}};return e.jsx(N,{show:n,as:s.Fragment,children:e.jsxs(v,{as:"div",className:"relative z-50",onClose:()=>i(null),children:[e.jsx(N.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:e.jsx(N.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsx(v.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-lg bg-white p-6 text-left align-middle shadow-xl transition-all",children:e.jsxs("form",{onSubmit:h(g),children:[e.jsxs("div",{className:"flex flex-col items-center text-center mb-4",children:[e.jsx(I,{className:"h-12 w-12 text-primary mb-3"}),e.jsx(v.Title,{as:"h3",className:"text-lg font-semibold leading-6 text-gray-900 mb-4",children:"Create Job"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",...l("name",{required:"Name is required"}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Enter job name"}),a.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.name.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Project ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{...l("projectId",{required:"Project is required",min:{value:1,message:"Project is required"}}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:0,children:"Select a project..."}),f.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),a.projectId&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.projectId.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Priority ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{...l("priorityId",{required:"Priority is required",min:{value:1,message:"Priority is required"}}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:0,children:"Select a priority..."}),x.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),a.priorityId&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.priorityId.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Machine ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{...l("machineId",{required:"Machine is required",min:{value:1,message:"Machine is required"}}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:0,children:"Select a machine..."}),m.map(t=>e.jsx("option",{value:t.id,children:t.machineName},t.id))]}),a.machineId&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.machineId.message})]})]}),e.jsxs("div",{className:"mt-6 flex gap-3",children:[e.jsx("button",{type:"button",className:"inline-flex justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2",onClick:()=>i(null),disabled:c,children:"Cancel"}),e.jsx("button",{type:"submit",className:"inline-flex justify-center rounded-md bg-primary px-4 py-2 text-sm font-medium text-white hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",disabled:c,children:c?"Creating...":"Create"})]})]})})})})})]})})}function K(){const n=k(),i=P(t=>t.showToast),[f,p]=s.useState([]),[x,b]=s.useState(0),[m,y]=s.useState(""),[c,o]=s.useState(!1),l=[{key:"Name",label:"Name",filterable:!0,sortable:!1,filterType:"text"},{key:"HostName",label:"HostName",filterable:!0,sortable:!1,filterType:"text"},{key:"ProjectName",label:"ProjectName",filterable:!0,sortable:!1,filterType:"text"},{key:"MachineUser",label:"Machine User",filterable:!0,sortable:!1,filterType:"text"},{key:"State",label:"State",filterable:!1,sortable:!1,filterType:"text"},{key:"Priority",label:"Priority",filterable:!0,sortable:!1,filterType:"text"},{key:"PackageVersion",label:"Robot Version",filterable:!0,sortable:!1,filterType:"text"},{key:"StartedAt",label:"StartedAt",filterable:!1,sortable:!0,filterType:"text"},{key:"EndedAt",label:"EndedAt",filterable:!1,sortable:!1,filterType:"text"},{key:"actions",label:"Actions",type:"action"}],h=[{label:"Preview",action:"preview",icon:"preview"},{label:"Execute",action:"execute",icon:"play"}];s.useEffect(()=>{a()},[m]);const a=async()=>{try{const t=await w.getAllJobs(m);b(t.totalItems),p(t.items.map(r=>({id:r.id,Name:r.name,HostName:r.hostname,MachineUser:r.machineUser,State:r.state,Priority:r.priority,StartedAt:r.started,EndedAt:r.ended,Robot:r.robot,PackageVersion:r.packageVersion,ProjectName:r.projectName})))}catch(t){console.error("Erro ao carregar jobs:",t)}},u=async t=>{switch(t.action){case"preview":n(`/job-details/${t.item.id}`);break;case"execute":await j(t.item.id);break}},j=async t=>{try{await w.executeJob(t),i("Success","Job executed successfully","success"),a()}catch(r){const d=r.response?.data?.message||"Failed to execute job";i("Error",d,"error")}},g=async t=>{if(!t){o(!1);return}try{await w.createJob(t),i("Success","Job created successfully","success"),o(!1),a()}catch(r){const d=r.response?.data?.message||"Failed to create job";i("Error",d,"error")}};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsxs("div",{className:"flex flex-wrap justify-between items-center gap-4 mb-8",children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-semibold text-text-primary",children:"Jobs"}),e.jsx("button",{onClick:()=>o(!0),className:"inline-flex items-center justify-center px-5 py-2.5 rounded-xl font-medium text-white bg-orange hover:bg-orange/90 shadow-sm hover:shadow transition-all duration-200",children:"Create"})]}),e.jsx("section",{className:"mt-6",children:e.jsx(T,{columns:l,data:f,totalItems:x,pageSize:5,pageSizeOptions:[5,10,25,100],showFirstLastButtons:!0,actionMenuItems:h,onActionClick:u,onQueryParamsChange:y})}),e.jsx(F,{isOpen:c,onClose:g})]})}export{K as default};
