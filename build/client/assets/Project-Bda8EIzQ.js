import{r as n,v as F,j as a}from"./vendor-react-D3RE0R8o.js";import{c as U,d as D}from"./vendor-router-C5YTkdq4.js";import{p as g}from"./projects.service-AnNXoBpb.js";import{a as L,p as C}from"./packagesVersions.service-Di9Xz39b.js";import{u as T}from"./notification.service-CvsIel6B.js";import{F as f,a as l,b as z,c as b}from"./FormButton-D9NdO0Hp.js";import"./api-BB9j10S9.js";function H(){const{id:i}=U(),d=D(),c=!!i,u=T(e=>e.showToast),[P,N]=n.useState([]),[y,h]=n.useState([]),[S,j]=n.useState(!1),{register:t,handleSubmit:V,formState:{errors:o},setValue:r,watch:I}=F({defaultValues:{name:"",description:"",status:"",packageVersionId:0,active:!1,autoUpdate:!1,package:0}}),p=I("package");n.useEffect(()=>{(async()=>(await v(),c&&i&&await q(Number(i))))()},[i,c]),n.useEffect(()=>{p>0?(x(p),j(!0),r("packageVersionId",0)):(h([]),j(!1),r("packageVersionId",0))},[p]);const v=async()=>{try{const e=await C.getPackageCompany();return N(e),e}catch(e){console.error("Erro ao carregar packages:",e)}},x=async e=>{try{const s=await L.getByIdPackageVersion(e);return h(s),s}catch(s){console.error("Erro ao carregar versões:",s)}},q=async e=>{try{const s=await g.getByIdProject(e),m=(await v()||[]).find(E=>E.name===s.packageName)?.id??0;r("name",s.name),r("description",s.description),r("status",s.status),r("active",s.active),r("autoUpdate",s.autoUpdate),r("packageVersionId",s.packageVersionId),r("package",m),m>0&&await x(m)}catch(s){console.error("Erro ao carregar projeto:",s)}},w=async e=>{try{if(c&&i){const s={projectName:e.name,description:e.description,status:e.status,packageVersionId:e.packageVersionId,active:e.active,autoUpdate:e.autoUpdate};await g.updateProject(Number(i),s),u("Sucess","Project edited successfully","success"),d("/automation")}else{const s={projectName:e.name,description:e.description,status:e.status,packageVersionId:e.packageVersionId,active:e.active,autoUpdate:e.autoUpdate};await g.createProject(s),u("Success","Project created successfully","success"),d("/automation")}}catch(s){const k=s.response?.data?.message||"Falha ao salvar projeto";u("Error",k,"error")}};return a.jsxs("div",{className:"min-h-screen bg-background",children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("button",{onClick:()=>d("/automation"),className:"text-primary hover:text-primary/80 mb-4",children:"← Voltar"}),a.jsx("h1",{className:"text-4xl font-semibold text-text-primary",children:c?"Edit Project":"Create Project"})]}),a.jsxs("form",{onSubmit:V(w),className:"bg-white rounded-2xl shadow-card p-8",children:[a.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[a.jsx("div",{children:a.jsx(f,{label:"Name",required:!0,placeholder:"DOWLOANDS_NFE",error:o.name?.message,...t("name",{required:"Name is required",minLength:{value:5,message:"Name must be at least 5 characters"}})})}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsx("div",{children:a.jsxs(l,{label:"Active",...t("active"),children:[a.jsx("option",{value:"true",children:"True"}),a.jsx("option",{value:"false",children:"False"})]})}),a.jsx("div",{children:a.jsxs(l,{label:"Auto Update Version",...t("autoUpdate"),children:[a.jsx("option",{value:"true",children:"True"}),a.jsx("option",{value:"false",children:"False"})]})})]}),a.jsx("div",{children:a.jsx(f,{label:"Status",required:!0,placeholder:"DOWLOANDS_NFE",error:o.status?.message,...t("status",{required:"Status is required",minLength:{value:5,message:"Status must be at least 5 characters"}})})}),a.jsx("div",{children:a.jsx(z,{label:"Description",required:!0,rows:4,placeholder:"Projeto destinado a acessar o site da fazenda, e fazer downloads das nfes",error:o.description?.message,...t("description",{required:"Description is required",minLength:{value:5,message:"Description must be at least 5 characters"}})})}),a.jsx("div",{children:a.jsxs(l,{label:"Package Name",required:!0,error:o.package?.message,...t("package",{required:"Package is required",min:{value:1,message:"Package is required"}}),children:[a.jsx("option",{value:0,children:"Filter the package..."}),P.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))]})}),a.jsx("div",{children:a.jsxs(l,{label:"Version Package",required:!0,error:o.packageVersionId?.message,disabled:!S||c,className:"disabled:bg-background disabled:cursor-not-allowed",...t("packageVersionId",{required:"Version package is required",min:{value:1,message:"Version package is required"}}),children:[a.jsx("option",{value:0,children:"Filter the version…"}),y.map(e=>a.jsx("option",{value:e.id,children:e.version},e.id))]})})]}),a.jsxs("div",{className:"mt-8 flex justify-end gap-3",children:[a.jsx(b,{variant:"secondary",type:"button",onClick:()=>d("/automation"),children:"Cancel"}),a.jsx(b,{type:"submit",children:c?"Edit":"Create"})]})]})]})}export{H as default};
