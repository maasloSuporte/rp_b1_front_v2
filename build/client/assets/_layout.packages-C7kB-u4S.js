import{d as v,w as N}from"./vendor-router-C5YTkdq4.js";import{r as n,j as a}from"./vendor-react-D3RE0R8o.js";import{p as S,a as D}from"./packagesVersions.service-Di9Xz39b.js";import{u as P}from"./modal.service-DONi3Oau.js";import{u as V}from"./notification.service-CvsIel6B.js";import{D as C}from"./DynamicTable-BPyWbqtX.js";import"./api-BB9j10S9.js";const T={downloadBlobFile:(i,l)=>{const s=window.URL.createObjectURL(i),r=document.createElement("a");r.href=s,r.download=l,r.click(),window.URL.revokeObjectURL(s)}};function U(){const i=v(),l=P(e=>e.confirmDownload),s=V(e=>e.showToast),[r,u]=n.useState([]),[f,w]=n.useState(0),[m,g]=n.useState(""),[c,d]=n.useState(!1),b=[{key:"Name",label:"Name",filterable:!0,sortable:!1,filterType:"text"},{key:"Description",label:"Description",filterable:!0,sortable:!1,filterType:"text"},{key:"PackageVersion",label:"PackageVersion",filterable:!0,sortable:!1,filterType:"text"},{key:"actions",label:"Actions",type:"action"}],x=[{label:"Download",action:"download",icon:"download"}];n.useEffect(()=>{h()},[m]);const h=async()=>{try{const e=await S.getAllPackages(m);w(e.totalItems),u(e.items.map(t=>({id:t.id,Name:t.name,Description:t.description,PackageVersion:t.packageVersions?.map(o=>o.version).join(", ")??"",rawPackageVersions:t.packageVersions??[]})))}catch(e){console.error("Erro ao carregar packages:",e)}},k=async e=>{e.action==="download"&&await y(e.item)},y=async e=>{const t=await l({title:`Download - ${e.Name}`,versions:e.rawPackageVersions.map(o=>({id:o.id,version:o.version}))});if(t)try{const o=await D.getDownloadPackage(t.id),j=`v${t.version}-${e.Name}.zip`;T.downloadBlobFile(o,j),s("Success","Download completed successfully","success")}catch{s("Error","Failed to download package","error")}},p=e=>{i("/packages/upload",{state:{isNew:e}})};return a.jsxs("div",{className:"min-h-screen bg-background",children:[a.jsxs("div",{className:"flex flex-wrap justify-between items-center gap-4 mb-8",children:[a.jsx("h1",{className:"text-3xl sm:text-4xl font-semibold text-text-primary",children:"Packages"}),a.jsxs("div",{className:"relative",children:[a.jsxs("button",{onClick:()=>d(!c),className:"inline-flex items-center justify-center px-5 py-2.5 rounded-xl font-medium text-white bg-orange hover:bg-orange/90 shadow-sm hover:shadow transition-all duration-200",children:["Upload",a.jsx("span",{className:`ml-1 transform transition-transform ${c?"rotate-180":""}`,children:"â–¼"})]}),c&&a.jsxs("div",{className:"absolute right-0 mt-2 bg-white rounded-xl shadow-card border border-border z-10 min-w-[120px] py-1",children:[a.jsx("button",{onClick:()=>{p(!0),d(!1)},className:"block w-full text-left px-4 py-2.5 text-text-primary hover:bg-gray-50 rounded-t-xl transition-colors",children:"New"}),a.jsx("button",{onClick:()=>{p(!1),d(!1)},className:"block w-full text-left px-4 py-2.5 text-text-primary hover:bg-gray-50 rounded-b-xl transition-colors",children:"Upgrade"})]})]})]}),a.jsx("section",{className:"mt-6",children:a.jsx(C,{columns:b,data:r,totalItems:f,pageSize:5,pageSizeOptions:[5,10,25,100],showFirstLastButtons:!0,actionMenuItems:x,onActionClick:k,onQueryParamsChange:g})})]})}const $=N(function(){return a.jsx(U,{})});export{$ as default};
