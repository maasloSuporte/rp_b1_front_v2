import{d as T,w as I}from"./vendor-router-cHSbYr8A.js";import{u as J,r as o,j as e,s as _,m as F}from"./vendor-react-GjWeapsa.js";import{p as L}from"./projects.service-DTH5gNiz.js";import{p as $}from"./priority.service-CMxhtK8e.js";import{d as A}from"./devices.service-uF7n0LQ8.js";import{j as y}from"./job.service-Bn0VNBC8.js";import{u as B}from"./notification.service-DGIhKrzX.js";import"./api-Cdl3BoFR.js";function O(){const{t}=J("translation"),l=T(),i=B(s=>s.showToast),[f,v]=o.useState([]),[N,w]=o.useState([]),[g,S]=o.useState([]),[u,P]=o.useState(0),[m,C]=o.useState(0),[d,k]=o.useState(0),[h,E]=o.useState(""),[n,p]=o.useState([{name:"",type:"",value:""}]),[b,j]=o.useState(!1);o.useEffect(()=>{R()},[]);const R=async()=>{try{const[s,r,a]=await Promise.all([L.getProjects(),$.getPriority(),A.getDevices()]);v(s),w(r),S(a)}catch(s){console.error("Erro ao carregar dados:",s),i(t("common.states.error"),t("pages.execution.executeError"),"error")}},D=()=>{p([...n,{name:"",type:"",value:""}])},q=s=>{n.length>1&&p(n.filter((r,a)=>a!==s))},x=(s,r,a)=>{const c=[...n];c[s]={...c[s],[r]:a},p(c)},M=async s=>{if(s.preventDefault(),u===0||m===0||d===0){i(t("common.states.error"),t("pages.execution.executeError"),"error");return}const r=h.trim()||`Execution-${Date.now()}`;j(!0);try{const a=await y.createJob({name:r,projectId:u,priorityId:d,machineId:m});await y.executeJob(a.id),i(t("common.states.success"),t("pages.execution.executeSuccess"),"success"),l("/jobs")}catch(a){const c=a.response?.data?.message||t("pages.execution.executeError");i(t("common.states.error"),c,"error")}finally{j(!1)}};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>l("/automation"),className:"text-primary hover:text-primary/80 mb-4 flex items-center gap-2",children:["← ",t("pages.execution.backToAutomation")]}),e.jsx("h1",{className:"text-4xl font-semibold text-text-primary",children:t("pages.execution.title")})]}),e.jsxs("form",{onSubmit:M,className:"bg-white rounded-lg shadow-card p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("pages.execution.jobName")}),e.jsx("input",{type:"text",value:h,onChange:s=>E(s.target.value),placeholder:t("pages.execution.jobNamePlaceholder"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t("pages.execution.selectProject")," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:u,onChange:s=>P(Number(s.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary",required:!0,children:[e.jsx("option",{value:0,children:t("pages.execution.selectProject")}),f.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t("pages.execution.selectMachine")," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:m,onChange:s=>C(Number(s.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary",required:!0,children:[e.jsx("option",{value:0,children:t("pages.execution.selectMachine")}),g.map(s=>e.jsx("option",{value:s.id,children:s.machineName},s.id))]}),g.length===0&&e.jsx("p",{className:"mt-1 text-sm text-amber-600",children:"Nenhuma máquina registrada. O agent precisa estar instalado e conectado na máquina para aparecer aqui."})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t("pages.execution.selectPriority")," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:d,onChange:s=>k(Number(s.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary",required:!0,children:[e.jsx("option",{value:0,children:t("pages.execution.selectPriority")}),N.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[t("pages.execution.parameters")," ",e.jsx("span",{className:"text-gray-400 font-normal",children:"(opcional)"})]}),e.jsxs("button",{type:"button",onClick:D,className:"flex items-center gap-2 text-primary hover:text-primary/80",children:[e.jsx(_,{className:"w-5 h-5"}),t("pages.execution.addParameter")]})]}),e.jsx("div",{className:"space-y-3",children:n.map((s,r)=>e.jsxs("div",{className:"grid grid-cols-12 gap-3 items-center",children:[e.jsx("div",{className:"col-span-4",children:e.jsx("input",{type:"text",placeholder:t("pages.execution.namePlaceholder"),value:s.name,onChange:a=>x(r,"name",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"})}),e.jsx("div",{className:"col-span-3",children:e.jsxs("select",{value:s.type,onChange:a=>x(r,"type",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"",children:t("pages.execution.selectType")}),e.jsx("option",{value:"string",children:t("pages.execution.typeString")}),e.jsx("option",{value:"number",children:t("pages.execution.typeNumber")}),e.jsx("option",{value:"boolean",children:t("pages.execution.typeBoolean")})]})}),e.jsx("div",{className:"col-span-4",children:e.jsx("input",{type:"text",placeholder:t("pages.execution.valuePlaceholder"),value:s.value,onChange:a=>x(r,"value",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"})}),e.jsx("div",{className:"col-span-1",children:n.length>1&&e.jsx("button",{type:"button",onClick:()=>q(r),className:"text-red-600 hover:text-red-800",children:e.jsx(F,{className:"w-5 h-5"})})})]},r))})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>l("/automation"),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:t("common.buttons.cancel")}),e.jsx("button",{type:"submit",disabled:b,className:"px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed",children:b?"...":t("pages.execution.execute")})]})]})]})}const X=I(function(){return e.jsx(O,{})});export{X as default};
