import{r as d,v as Z,j as e,w as p}from"./vendor-react-D3RE0R8o.js";import{c as _,d as z}from"./vendor-router-C5YTkdq4.js";import{s as f}from"./schedule.service-DkpaHhKp.js";import{a as J}from"./api-BB9j10S9.js";import{p as U}from"./priority.service-CsXr_6UM.js";import{p as K}from"./projects.service-AnNXoBpb.js";import{d as Y}from"./devices.service-BEkRjjz1.js";import{u as G}from"./notification.service-CvsIel6B.js";import{F as Q,a as v,b as X,c as S}from"./FormButton-D9NdO0Hp.js";const $={getFrequency:async()=>(await J.get("/frequencies")).data},k=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],l="w-full min-h-[2.75rem] px-4 py-3 text-base text-text-primary bg-white border-2 border-border-form rounded-xl focus:outline-none focus:border-primary focus:ring-4 focus:ring-primary/10 transition-all duration-200",N="w-full min-h-[2.75rem] px-4 py-3 text-base text-text-primary bg-white border-2 border-border-form rounded-xl focus:outline-none focus:border-primary focus:ring-4 focus:ring-primary/10 transition-all duration-200";function ce(){const{id:c}=_(),h=z(),y=!!c,s=G(r=>r.showToast),[q,O]=d.useState([]),[W,M]=d.useState([]),[w,D]=d.useState([]),[I,E]=d.useState([]),{register:t,handleSubmit:C,formState:{errors:u},setValue:F,watch:g,control:x}=Z({mode:"onChange",defaultValues:{frequencyId:0,name:"",projectId:0,machineId:0,priority:0,details:"",cronSchedulling:{timeZone:"E. South America Standard Time",minute:{every:""},hourly:{every:"",minute:""},daily:{every:"",hour:"",minute:""},weekly:{every:"",dayOfWeek:[]},monthlyDay:{every:"",dayOfMonth:"",hour:"",minute:""},monthlyWeek:{every:"",weekOfMonth:"",dayOfWeek:"",hour:"",minute:""}}}}),m=g("frequencyId"),b=g("cronSchedulling.hourly.every"),j=g("cronSchedulling.hourly.minute");d.useEffect(()=>{m===2&&console.log("Watch - hourlyEvery:",b,"hourlyMinute:",j)},[m,b,j]),d.useEffect(()=>{P(),R(),T(),B(),y&&c&&H(Number(c))},[c,y]);const P=async()=>{try{const r=await $.getFrequency();O(r)}catch(r){console.error("Erro ao carregar frequências:",r)}},R=async()=>{try{const r=await K.getProjects();M(r)}catch(r){console.error("Erro ao carregar projetos:",r)}},T=async()=>{try{const r=await Y.getDevices();D(r)}catch(r){console.error("Erro ao carregar máquinas:",r)}},B=async()=>{try{const r=await U.getPriority();E(r)}catch(r){console.error("Erro ao carregar prioridades:",r)}},H=async r=>{try{await f.getByIdSchedule(r)}catch(n){console.error("Erro ao carregar schedule:",n)}},A=(r,n)=>{const o={timeZone:n.timeZone,minute:{every:""},hourly:{every:"",minute:""},daily:{every:"",hour:"",minute:""},weekly:{every:"",dayOfWeek:[]},monthlyDay:{every:"",dayOfMonth:"",hour:"",minute:""},monthlyWeek:{every:"",weekOfMonth:"",dayOfWeek:[],hour:"",minute:""},cron:""};return{1:{...o,minute:{every:String(n.minute.every||"")},hourly:{every:"",minute:""},daily:{every:"",hour:"",minute:""},weekly:{every:"",dayOfWeek:[]},monthlyDay:{every:"",dayOfMonth:"",hour:"",minute:""},monthlyWeek:{every:"",weekOfMonth:"",dayOfWeek:[],hour:"",minute:""}},2:{...o,minute:{every:""},hourly:{every:String(n.hourly.every||""),minute:String(n.hourly.minute||"")},daily:{every:"",hour:"",minute:""},weekly:{every:"",dayOfWeek:[]},monthlyDay:{every:"",dayOfMonth:"",hour:"",minute:""},monthlyWeek:{every:"",weekOfMonth:"",dayOfWeek:[],hour:"",minute:""}},3:{...o,minute:{every:""},hourly:{every:"",minute:""},daily:{every:String(n.daily.every),hour:String(n.daily.hour),minute:String(n.daily.minute)},weekly:{every:"",dayOfWeek:[]},monthlyDay:{every:"",dayOfMonth:"",hour:"",minute:""},monthlyWeek:{every:"",weekOfMonth:"",dayOfWeek:[],hour:"",minute:""}},4:{...o,minute:{every:""},hourly:{every:"",minute:""},daily:{every:"",hour:"",minute:""},weekly:{every:String(n.weekly.every),dayOfWeek:n.weekly.dayOfWeek||[]},monthlyDay:{every:"",dayOfMonth:"",hour:"",minute:""},monthlyWeek:{every:"",weekOfMonth:"",dayOfWeek:[],hour:"",minute:""}},5:{...o,minute:{every:""},hourly:{every:"",minute:""},daily:{every:"",hour:"",minute:""},weekly:{every:"",dayOfWeek:[]},monthlyDay:{every:String(n.monthlyDay.every),dayOfMonth:String(n.monthlyDay.dayOfMonth),hour:String(n.monthlyDay.hour),minute:String(n.monthlyDay.minute)},monthlyWeek:{every:"",weekOfMonth:"",dayOfWeek:[],hour:"",minute:""}},6:{...o,minute:{every:""},hourly:{every:"",minute:""},daily:{every:"",hour:"",minute:""},weekly:{every:"",dayOfWeek:[]},monthlyDay:{every:"",dayOfMonth:"",hour:"",minute:""},monthlyWeek:{every:String(n.monthlyWeek.every),weekOfMonth:String(n.monthlyWeek.weekOfMonth),dayOfWeek:[n.monthlyWeek.dayOfWeek],hour:String(n.monthlyWeek.hour),minute:String(n.monthlyWeek.minute)}}}[r]||o},V=async r=>{try{console.log("=== DADOS DO FORMULÁRIO ==="),console.log("FrequencyId:",r.frequencyId),console.log("CronSchedulling completo:",JSON.stringify(r.cronSchedulling,null,2)),console.log("Hourly values:",{every:r.cronSchedulling.hourly.every,minute:r.cronSchedulling.hourly.minute,everyType:typeof r.cronSchedulling.hourly.every,minuteType:typeof r.cronSchedulling.hourly.minute}),console.log("=== DADOS DO FORMULÁRIO ==="),console.log("FrequencyId:",r.frequencyId),console.log("CronSchedulling completo:",JSON.stringify(r.cronSchedulling,null,2)),console.log("Hourly values:",{every:r.cronSchedulling.hourly.every,minute:r.cronSchedulling.hourly.minute,everyType:typeof r.cronSchedulling.hourly.every,minuteType:typeof r.cronSchedulling.hourly.minute});const n=Number(r.frequencyId);if(n===2){const o=r.cronSchedulling.hourly.every,i=r.cronSchedulling.hourly.minute;if(!o||o===""||Number(o)<=0){console.error("Erro: every inválido ou vazio"),s("Error",'Para frequência Hourly, o campo "Repeat every" é obrigatório e deve ser maior que 0',"error");return}if(i==null||i===""||Number(i)<0||Number(i)>59){console.error("Erro: minute inválido ou vazio"),s("Error",'Para frequência Hourly, o campo "Minute" é obrigatório e deve ser entre 0 e 59',"error");return}}else if(n===1){if(!r.cronSchedulling.minute.every){s("Error",'Para frequência Minute, o campo "Every" é obrigatório',"error");return}}else if(n===3){if(!r.cronSchedulling.daily.every||!r.cronSchedulling.daily.hour||!r.cronSchedulling.daily.minute){s("Error",'Para frequência Daily, os campos "Repeat every", "Hour" e "Minute" são obrigatórios',"error");return}}else if(n===4){if(!r.cronSchedulling.weekly.every||!r.cronSchedulling.weekly.dayOfWeek||r.cronSchedulling.weekly.dayOfWeek.length===0){s("Error",'Para frequência Weekly, os campos "Repeat every" e "Day of Week" são obrigatórios',"error");return}}else if(n===5){if(!r.cronSchedulling.monthlyDay.every||!r.cronSchedulling.monthlyDay.dayOfMonth||!r.cronSchedulling.monthlyDay.hour||!r.cronSchedulling.monthlyDay.minute){s("Error","Para frequência Monthly Day, todos os campos são obrigatórios","error");return}}else if(n===6&&(!r.cronSchedulling.monthlyWeek.every||!r.cronSchedulling.monthlyWeek.weekOfMonth||!r.cronSchedulling.monthlyWeek.dayOfWeek||!r.cronSchedulling.monthlyWeek.hour||!r.cronSchedulling.monthlyWeek.minute)){s("Error","Para frequência Monthly Week, todos os campos são obrigatórios","error");return}if(y&&c){const o={frequencyId:r.frequencyId,name:r.name,priority:r.priority,details:r.details};await f.updateSchedule(Number(c),o),s("Success","Schedule updated successfully","success"),h("/scheduled")}else{const o={frequencyId:Number(r.frequencyId),name:r.name,projectId:Number(r.projectId),machineId:Number(r.machineId),priority:Number(r.priority),details:r.details,arguments:[{name:"default",key:"default",value:"default",order:1}],cronSchedulling:A(Number(r.frequencyId),r.cronSchedulling)};await f.createSchedule(o),s("Success","Schedule created successfully","success"),h("/scheduled")}}catch(n){const o=n.response?.data?.message||"Falha ao salvar schedule";s("Error",o,"error")}},L=()=>{const r=Number(m);switch(console.log("renderCronFields - frequencyId:",m,"tipo:",typeof m,"convertido:",r),r){case 1:return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Every (minutes)"}),e.jsx("input",{type:"number",...t("cronSchedulling.minute.every"),className:l})]});case 2:return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Repeat every *"}),e.jsx(p,{name:"cronSchedulling.hourly.every",control:x,rules:{required:"Repeat every é obrigatório",validate:n=>{if(!n||n==="")return"Repeat every é obrigatório";const o=Number(n);return isNaN(o)||o<=0?"Deve ser maior que 0":!0}},render:({field:n,fieldState:o})=>e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",min:"1",step:"1",value:n.value||"",onChange:i=>{const a=i.target.value;console.log("Every onChange - valor recebido:",a,"tipo:",typeof a),console.log("Every onChange - field.value antes:",n.value),n.onChange(a),console.log("Every onChange - field.onChange chamado com:",a)},onBlur:i=>{n.onBlur(),console.log("Every onBlur - valor final:",i.target.value)},name:n.name,ref:n.ref,className:l}),o.error&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.error.message})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Minute *"}),e.jsx(p,{name:"cronSchedulling.hourly.minute",control:x,rules:{required:"Minute é obrigatório",validate:n=>{if(n==null||n==="")return"Minute é obrigatório";const o=Number(n);return isNaN(o)||o<0||o>59?"Deve ser entre 0 e 59":!0}},render:({field:n,fieldState:o})=>e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",min:"0",max:"59",step:"1",value:n.value||"",onChange:i=>{const a=i.target.value;console.log("Minute onChange - valor recebido:",a,"tipo:",typeof a),console.log("Minute onChange - field.value antes:",n.value),n.onChange(a),console.log("Minute onChange - field.onChange chamado com:",a)},onBlur:i=>{n.onBlur(),console.log("Minute onBlur - valor final:",i.target.value)},name:n.name,ref:n.ref,className:l}),o.error&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.error.message})]})})]})]});case 3:return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Repeat every *"}),e.jsx("input",{type:"number",...t("cronSchedulling.daily.every"),className:l})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Hour"}),e.jsx("input",{type:"number",...t("cronSchedulling.daily.hour"),className:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Minute"}),e.jsx("input",{type:"number",...t("cronSchedulling.daily.minute"),className:l})]})]})]});case 4:return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Repeat every *"}),e.jsx("input",{type:"number",...t("cronSchedulling.weekly.every"),className:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Day of Week"}),e.jsx(p,{name:"cronSchedulling.weekly.dayOfWeek",control:x,render:({field:n})=>e.jsx("select",{multiple:!0,...n,className:N,children:k.map(o=>e.jsx("option",{value:o,children:o},o))})})]})]});case 5:return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Repeat every *"}),e.jsx("input",{type:"number",...t("cronSchedulling.monthlyDay.every"),className:l})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Day of Month"}),e.jsx("input",{type:"number",...t("cronSchedulling.monthlyDay.dayOfMonth"),className:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Hour"}),e.jsx("input",{type:"number",...t("cronSchedulling.monthlyDay.hour"),className:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Minute"}),e.jsx("input",{type:"number",...t("cronSchedulling.monthlyDay.minute"),className:l})]})]})]});case 6:return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Repeat every *"}),e.jsx("input",{type:"number",...t("cronSchedulling.monthlyWeek.every"),className:l})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Week of Month"}),e.jsx("input",{type:"number",...t("cronSchedulling.monthlyWeek.weekOfMonth"),className:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Day of Week"}),e.jsx("select",{...t("cronSchedulling.monthlyWeek.dayOfWeek"),className:N,children:k.map(n=>e.jsx("option",{value:n,children:n},n))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Hour"}),e.jsx("input",{type:"number",...t("cronSchedulling.monthlyWeek.hour"),className:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Minute"}),e.jsx("input",{type:"number",...t("cronSchedulling.monthlyWeek.minute"),className:l})]})]})]});default:return null}};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("button",{onClick:()=>h("/scheduled"),className:"text-primary hover:text-primary/80 mb-4 font-medium text-base",children:"← Voltar"}),e.jsx("h1",{className:"text-4xl font-semibold text-text-primary",children:y?"Edit Schedule":"Create Schedule"})]}),e.jsxs("form",{onSubmit:C(V),className:"bg-white rounded-2xl shadow-card p-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(Q,{label:"Name",required:!0,placeholder:"DOWLOANDS_NFE",error:u.name?.message,...t("name",{required:"Name is required",minLength:{value:5,message:"Name must be at least 5 characters"}})})}),e.jsx("div",{children:e.jsxs(v,{label:"Project",required:!0,error:u.projectId?.message,...t("projectId",{required:"Project is required",min:{value:1,message:"Project is required"}}),children:[e.jsx("option",{value:0,children:"Filter the project"}),W.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})}),e.jsx("div",{children:e.jsxs(v,{label:"Priority",required:!0,error:u.priority?.message,...t("priority",{required:"Priority is required",min:{value:1,message:"Priority is required"}}),children:[e.jsx("option",{value:0,children:"Filter the priority"}),I.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})}),e.jsx("div",{children:e.jsxs(v,{label:"Frequency",required:!0,error:u.frequencyId?.message,...t("frequencyId",{required:"Frequency is required",min:{value:1,message:"Frequency is required"},valueAsNumber:!0}),onChange:r=>{const n=Number(r.target.value);F("frequencyId",n,{shouldValidate:!0}),console.log("Frequency onChange - valor selecionado:",n,"tipo:",typeof n)},children:[e.jsx("option",{value:0,children:"Filter the frequency"}),q.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})}),e.jsx("div",{children:e.jsxs(v,{label:"Machine",required:!0,error:u.machineId?.message,...t("machineId",{required:"Machine is required",min:{value:1,message:"Machine is required"}}),children:[e.jsx("option",{value:0,children:"Filter the machine"}),w.map(r=>e.jsx("option",{value:r.id,children:r.machineName},r.id))]})}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(X,{label:"Details",required:!0,rows:4,placeholder:"Schedule details",error:u.details?.message,...t("details",{required:"Details is required",minLength:{value:5,message:"Details must be at least 5 characters"}})})}),Number(m)>0&&e.jsxs("div",{className:"md:col-span-2 border-t border-border-form pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-4",children:"Cron Scheduling"}),L()]})]}),e.jsxs("div",{className:"mt-8 flex justify-end gap-3",children:[e.jsx(S,{variant:"secondary",type:"button",onClick:()=>h("/scheduled"),children:"Cancel"}),e.jsx(S,{type:"submit",children:y?"Edit":"Create"})]})]})]})}export{ce as default};
