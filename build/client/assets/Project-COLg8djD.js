import{u as U,r as d,x as F,j as a}from"./vendor-react-GjWeapsa.js";import{c as R,d as z}from"./vendor-router-cHSbYr8A.js";import{p as j}from"./projects.service-DTH5gNiz.js";import{a as B,p as C}from"./packagesVersions.service-FNVeQxB5.js";import{u as D}from"./notification.service-DGIhKrzX.js";import{F as b,a as l,b as M,c as P}from"./FormButton-Ds-bRHEx.js";import"./api-Cdl3BoFR.js";function K(){const{t:s}=U("translation"),{id:c}=R(),p=z(),i=!!c,u=D(e=>e.showToast),[y,N]=d.useState([]),[I,h]=d.useState([]),[S,v]=d.useState(!1),{register:o,handleSubmit:V,formState:{errors:n},setValue:r,watch:q}=F({defaultValues:{name:"",description:"",status:"",packageVersionId:0,active:!1,autoUpdate:!1,package:0}}),m=q("package");d.useEffect(()=>{(async()=>(await x(),i&&c&&await w(Number(c))))()},[c,i]),d.useEffect(()=>{m>0?(k(m),v(!0),r("packageVersionId",0)):(h([]),v(!1),r("packageVersionId",0))},[m]);const x=async()=>{try{const e=await C.getPackageCompany();return N(e),e}catch(e){console.error("Erro ao carregar packages:",e)}},k=async e=>{try{const t=await B.getByIdPackageVersion(e);return h(t),t}catch(t){console.error("Erro ao carregar versões:",t)}},w=async e=>{try{const t=await j.getByIdProject(e),g=(await x()||[]).find(L=>L.name===t.packageName)?.id??0;r("name",t.name),r("description",t.description),r("status",t.status),r("active",t.active),r("autoUpdate",t.autoUpdate),r("packageVersionId",t.packageVersionId),r("package",g),g>0&&await k(g)}catch(t){console.error("Erro ao carregar projeto:",t)}},E=async e=>{try{if(i&&c){const t={projectName:e.name,description:e.description,status:e.status,packageVersionId:e.packageVersionId,active:e.active,autoUpdate:e.autoUpdate};await j.updateProject(Number(c),t),u("Sucess","Project edited successfully","success"),p("/automation")}else{const t={projectName:e.name,description:e.description,status:e.status,packageVersionId:e.packageVersionId,active:e.active,autoUpdate:e.autoUpdate};await j.createProject(t),u("Success","Project created successfully","success"),p("/automation")}}catch(t){const f=t.response?.data?.message||s("pages.project.saveError");u("Error",f,"error")}};return a.jsxs("div",{className:"min-h-screen bg-background",children:[a.jsxs("div",{className:"mb-6",children:[a.jsxs("button",{onClick:()=>p("/automation"),className:"text-primary hover:text-primary/80 mb-4",children:["← ",s("pages.project.back")]}),a.jsx("h1",{className:"text-4xl font-semibold text-text-primary",children:s(i?"pages.project.titleEdit":"pages.project.titleCreate")})]}),a.jsxs("form",{onSubmit:V(E),className:"bg-white rounded-2xl shadow-card p-8",children:[a.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[a.jsx("div",{children:a.jsx(b,{label:s("pages.project.name"),required:!0,placeholder:"DOWLOANDS_NFE",error:n.name?.message,...o("name",{required:s("pages.project.nameRequired"),minLength:{value:5,message:s("pages.project.nameMinLength")}})})}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsx("div",{children:a.jsxs(l,{label:s("pages.project.active"),...o("active"),children:[a.jsx("option",{value:"true",children:s("common.true")}),a.jsx("option",{value:"false",children:s("common.false")})]})}),a.jsx("div",{children:a.jsxs(l,{label:s("pages.project.autoUpdateVersion"),...o("autoUpdate"),children:[a.jsx("option",{value:"true",children:s("common.true")}),a.jsx("option",{value:"false",children:s("common.false")})]})})]}),a.jsx("div",{children:a.jsx(b,{label:s("pages.project.status"),required:!0,placeholder:"DOWLOANDS_NFE",error:n.status?.message,...o("status",{required:s("pages.project.statusRequired"),minLength:{value:5,message:s("pages.project.statusMinLength")}})})}),a.jsx("div",{children:a.jsx(M,{label:s("pages.project.description"),required:!0,rows:4,placeholder:"Projeto destinado a acessar o site da fazenda, e fazer downloads das nfes",error:n.description?.message,...o("description",{required:s("pages.project.descriptionRequired"),minLength:{value:5,message:s("pages.project.descriptionMinLength")}})})}),a.jsx("div",{children:a.jsxs(l,{label:s("pages.project.packageName"),required:!0,error:n.package?.message,...o("package",{required:s("pages.project.packageRequired"),min:{value:1,message:s("pages.project.packageRequired")}}),children:[a.jsx("option",{value:0,children:s("pages.project.filterPackage")}),y.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))]})}),a.jsx("div",{children:a.jsxs(l,{label:s("pages.project.versionPackage"),required:!0,error:n.packageVersionId?.message,disabled:!S||i,className:"disabled:bg-background disabled:cursor-not-allowed",...o("packageVersionId",{required:s("pages.project.versionRequired"),min:{value:1,message:s("pages.project.versionRequired")}}),children:[a.jsx("option",{value:0,children:s("pages.project.filterVersion")}),I.map(e=>a.jsx("option",{value:e.id,children:e.version},e.id))]})})]}),a.jsxs("div",{className:"mt-8 flex justify-end gap-3",children:[a.jsx(P,{variant:"secondary",type:"button",onClick:()=>p("/automation"),children:s("common.buttons.cancel")}),a.jsx(P,{type:"submit",children:s(i?"common.buttons.edit":"common.buttons.create")})]})]})]})}export{K as default};
