import{u as $,r as b,x as B,j as e}from"./vendor-react-GjWeapsa.js";import{c as D,d as F}from"./vendor-router-cHSbYr8A.js";import{u as y,c as V}from"./users.service-DV2TtZrl.js";import{r as A}from"./roles.service-CqkRpITf.js";import{a as L}from"./api-Cdl3BoFR.js";import{u as O}from"./notification.service-DGIhKrzX.js";const z={createUserRole:async r=>{await L.post("/userRoles",r)}};function X(){const{t:r}=$("translation"),{id:n}=D(),x=F(),i=!!n,d=O(s=>s.showToast),[j,v]=b.useState([]),[c,u]=b.useState([]),[p,m]=b.useState([]),{register:l,handleSubmit:R,formState:{errors:a},setValue:g,watch:N}=B({defaultValues:{name:"",cpf:"",email:"",password:"",confirmPassword:"",phoneNumber:""}}),f=N("password"),h=N("confirmPassword");b.useEffect(()=>{S(),i&&n&&k(n)},[n,i]);const k=async s=>{try{const t=await y.getByIdUser(s);console.log(t),g("name",t.name),g("cpf",t.cpf),g("email",t.email),g("phoneNumber",t.phoneNumber)}catch(t){console.error("Erro ao carregar usuário:",t)}},S=async()=>{try{const s=await A.getAllRoles();v(s)}catch(s){console.error("Erro ao carregar roles:",s)}},w=s=>{m(t=>t.includes(s)?t.filter(o=>o!==s):[...t,s])},q=s=>{c.includes(s)||u(t=>[...t,s]),m(t=>t.filter(o=>o!==s))},U=s=>{u(t=>t.filter(o=>o!==s)),m(t=>t.filter(o=>o!==s))},C=()=>{p.forEach(s=>{c.includes(s)||u(t=>[...t,s])}),m([])},E=()=>{u(s=>s.filter(t=>!p.includes(t))),m([])},P=s=>{const t=j.find(o=>o.id===s);return t?t.name:`Role ${s}`},T=j.filter(s=>!c.includes(s.id)),M=async s=>{if(f!==h){d(r("common.states.error"),r("pages.user.passwordMismatch"),"error");return}if(c.length===0){d(r("common.warning"),r("pages.user.selectOneRole"),"warning");return}try{if(i&&n){const t={name:s.name,phoneNumber:s.phoneNumber};await y.updateUser(n,t),d(r("common.states.success"),r("pages.user.updateSuccess"),"success"),x("/users")}else{const t={name:s.name,cpf:s.cpf,email:s.email,password:s.password,phoneNumber:s.phoneNumber},o=await y.createUser(t);await V.createCompanyUser({userId:o.id,active:!0}),await z.createUserRole({userId:o.id,roleId:c}),d(r("common.states.success"),r("pages.user.createSuccess"),"success"),x("/users")}}catch(t){const o=t.response?.data?.message||r("pages.user.saveError");d(r("common.states.error"),o,"error")}};return e.jsxs("div",{className:"px-4 py-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>x("/users"),className:"text-indigo-600 hover:text-indigo-900 mb-4",children:["← ",r("pages.user.back")]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:r(i?"pages.user.titleEdit":"pages.user.titleCreate")})]}),e.jsxs("form",{onSubmit:R(M),className:"bg-white shadow rounded-lg p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:r("pages.user.name")}),e.jsx("input",{type:"text",...l("name",{required:r("pages.user.nameRequired")}),className:"mt-1 block w-full px-3 py-3 text-base border-0 border-b-2 border-gray-300 bg-transparent focus:outline-none focus:border-indigo-600 focus:ring-0 transition-colors"}),a.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:r("pages.user.cpf")}),e.jsx("input",{type:"text",...l("cpf",{required:r("pages.user.cpfRequired")}),disabled:i,className:"mt-1 block w-full px-3 py-3 text-base border-0 border-b-2 border-gray-300 bg-transparent focus:outline-none focus:border-indigo-600 focus:ring-0 transition-colors disabled:bg-gray-50 disabled:border-gray-200"}),a.cpf&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.cpf.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:r("pages.user.email")}),e.jsx("input",{type:"email",...l("email",{required:r("pages.user.emailRequired")}),disabled:i,className:"mt-1 block w-full px-3 py-3 text-base border-0 border-b-2 border-gray-300 bg-transparent focus:outline-none focus:border-indigo-600 focus:ring-0 transition-colors disabled:bg-gray-50 disabled:border-gray-200"}),a.email&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:r("pages.user.phone")}),e.jsx("input",{type:"text",...l("phoneNumber",{required:r("pages.user.phoneRequired")}),className:"mt-1 block w-full px-3 py-3 text-base border-0 border-b-2 border-gray-300 bg-transparent focus:outline-none focus:border-indigo-600 focus:ring-0 transition-colors"}),a.phoneNumber&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.phoneNumber.message})]}),!i&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:r("pages.user.password")}),e.jsx("input",{type:"password",...l("password",{required:r("pages.user.passwordRequired")}),className:"mt-1 block w-full px-3 py-3 text-base border-0 border-b-2 border-gray-300 bg-transparent focus:outline-none focus:border-indigo-600 focus:ring-0 transition-colors"}),a.password&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.password.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:r("pages.user.confirmPassword")}),e.jsx("input",{type:"password",...l("confirmPassword",{required:r("pages.user.confirmPasswordRequired")}),className:"mt-1 block w-full px-3 py-3 text-base border-0 border-b-2 border-gray-300 bg-transparent focus:outline-none focus:border-indigo-600 focus:ring-0 transition-colors"}),a.confirmPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.confirmPassword.message}),f&&h&&f!==h&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r("pages.user.passwordMismatch")})]})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-4",children:r("pages.user.roles")}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:r("pages.user.availableRoles")}),e.jsx("div",{className:"border rounded-md p-2 h-64 overflow-y-auto",children:T.map(s=>e.jsx("div",{className:`p-2 mb-1 rounded cursor-pointer ${p.includes(s.id)?"bg-indigo-100":"hover:bg-gray-100"}`,onClick:()=>w(s.id),onDoubleClick:()=>q(s.id),children:s.name},s.id))})]}),e.jsxs("div",{className:"flex flex-col justify-center items-center gap-2",children:[e.jsx("button",{type:"button",onClick:C,className:"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700",children:"→"}),e.jsx("button",{type:"button",onClick:E,className:"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700",children:"←"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:r("pages.user.selectedRoles")}),e.jsx("div",{className:"border rounded-md p-2 h-64 overflow-y-auto",children:c.map(s=>e.jsx("div",{className:`p-2 mb-1 rounded cursor-pointer ${p.includes(s)?"bg-indigo-100":"hover:bg-gray-100"}`,onClick:()=>w(s),onDoubleClick:()=>U(s),children:P(s)},s))})]})]})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{type:"submit",className:"bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:r(i?"common.buttons.save":"common.buttons.create")})})]})]})}export{X as default};
