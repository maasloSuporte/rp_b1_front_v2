import{u as Y,r as p,x as H,j as e,y as L,z as m}from"./vendor-react-GjWeapsa.js";import{c as K,d as V}from"./vendor-router-cHSbYr8A.js";import{s as v}from"./schedule.service-C92pRfiQ.js";import{f as Z}from"./frequency.service-DLKu-kq6.js";import{p as z}from"./priority.service-CMxhtK8e.js";import{p as Q}from"./projects.service-DTH5gNiz.js";import{d as U}from"./devices.service-uF7n0LQ8.js";import{u as $}from"./notification.service-DGIhKrzX.js";import{F as G,a as g,b as J,c as f}from"./FormButton-Ds-bRHEx.js";import"./api-Cdl3BoFR.js";const j=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],X={"Every Minute":"everyMinute",Hourly:"hourly",Daily:"daily",Weekly:"weekly","Monthly by Day":"monthlyByDay","Monthly by Week":"monthlyByWeek","Custom Cron":"customCron"},ee={1:"everyMinute",2:"hourly",3:"daily",4:"weekly",5:"monthlyByDay",6:"monthlyByWeek",7:"customCron"},re={Low:"low",Medium:"medium",High:"high",Critical:"critical"},ne={1:"low",2:"medium",3:"high",4:"critical"},a="w-full min-h-[2.75rem] px-4 py-3 text-base text-text-primary bg-white border-2 border-border-form rounded-xl focus:outline-none focus:border-primary focus:ring-4 focus:ring-primary/10 transition-all duration-200",k="w-full min-h-[2.75rem] px-4 py-3 text-base text-text-primary bg-white border-2 border-border-form rounded-xl focus:outline-none focus:border-primary focus:ring-4 focus:ring-primary/10 transition-all duration-200";function he(){const{t:l}=Y("translation"),{id:h}=K(),x=V(),u=!!h,c=$(n=>n.showToast),[S,N]=p.useState([]),[W,w]=p.useState([]),[O,q]=p.useState([]),[I,M]=p.useState([]),{register:i,handleSubmit:D,formState:{errors:y},setValue:t,watch:E,control:d}=H({mode:"onChange",defaultValues:{frequencyId:0,name:"",projectId:0,machineId:0,priority:0,details:"",cronSchedulling:{timeZone:"E. South America Standard Time",minute:{every:""},hourly:{every:"",minute:""},daily:{every:"",hour:"",minute:""},weekly:{every:"",dayOfWeek:[]},monthlyDay:{every:"",dayOfMonth:"",hour:"",minute:""},monthlyWeek:{every:"",weekOfMonth:"",dayOfWeek:"",hour:"",minute:""}}}}),b=E("frequencyId");p.useEffect(()=>{C(),R(),F(),B(),u&&h&&P(Number(h))},[h,u]);const C=async()=>{try{const n=await Z.getFrequency();N(n)}catch(n){console.error("Erro ao carregar frequências:",n)}},R=async()=>{try{const n=await Q.getProjects();w(n)}catch(n){console.error("Erro ao carregar projetos:",n)}},F=async()=>{try{const n=await U.getDevices();q(n)}catch(n){console.error("Erro ao carregar máquinas:",n)}},B=async()=>{try{const n=await z.getPriority();M(n)}catch(n){console.error("Erro ao carregar prioridades:",n)}},P=async n=>{try{const r=await v.getByIdSchedule(n);t("name",r.name),t("details",r.details),t("frequencyId",r.frequencyId),t("projectId",r.projectId),t("machineId",r.machineId),t("priority",r.priorityId);const s=r.schedule;s&&(t("cronSchedulling.timeZone",s.timeZone??"E. South America Standard Time"),t("cronSchedulling.minute.every",s.every??""),t("cronSchedulling.hourly.every",s.every??""),t("cronSchedulling.hourly.minute",s.minute??""),t("cronSchedulling.daily.every",s.every??""),t("cronSchedulling.daily.hour",s.hour??""),t("cronSchedulling.daily.minute",s.minute??""),t("cronSchedulling.weekly.every",s.every??""),t("cronSchedulling.weekly.dayOfWeek",Array.isArray(s.dayOfWeek)?s.dayOfWeek:[]),t("cronSchedulling.monthlyDay.every",s.every??""),t("cronSchedulling.monthlyDay.dayOfMonth",""),t("cronSchedulling.monthlyDay.hour",s.hour??""),t("cronSchedulling.monthlyDay.minute",s.minute??""),t("cronSchedulling.monthlyWeek.every",s.every??""),t("cronSchedulling.monthlyWeek.weekOfMonth",s.weekOfMonth??""),t("cronSchedulling.monthlyWeek.dayOfWeek",Array.isArray(s.dayOfWeek)?s.dayOfWeek[0]??"":""),t("cronSchedulling.monthlyWeek.hour",s.hour??""),t("cronSchedulling.monthlyWeek.minute",s.minute??""))}catch(r){console.error("Erro ao carregar schedule:",r),c("Error","Falha ao carregar dados do schedule","error")}},A=(n,r)=>{const s={timeZone:r.timeZone,minute:{every:""},hourly:{every:"",minute:""},daily:{every:"",hour:"",minute:""},weekly:{every:"",dayOfWeek:[]},monthlyDay:{every:"",dayOfMonth:"",hour:"",minute:""},monthlyWeek:{every:"",weekOfMonth:"",dayOfWeek:[],hour:"",minute:""},cron:""};return{1:{...s,minute:{every:String(r.minute.every||"")},hourly:{every:"",minute:""},daily:{every:"",hour:"",minute:""},weekly:{every:"",dayOfWeek:[]},monthlyDay:{every:"",dayOfMonth:"",hour:"",minute:""},monthlyWeek:{every:"",weekOfMonth:"",dayOfWeek:[],hour:"",minute:""}},2:{...s,minute:{every:""},hourly:{every:String(r.hourly.every||""),minute:String(r.hourly.minute||"")},daily:{every:"",hour:"",minute:""},weekly:{every:"",dayOfWeek:[]},monthlyDay:{every:"",dayOfMonth:"",hour:"",minute:""},monthlyWeek:{every:"",weekOfMonth:"",dayOfWeek:[],hour:"",minute:""}},3:{...s,minute:{every:""},hourly:{every:"",minute:""},daily:{every:String(r.daily.every),hour:String(r.daily.hour),minute:String(r.daily.minute)},weekly:{every:"",dayOfWeek:[]},monthlyDay:{every:"",dayOfMonth:"",hour:"",minute:""},monthlyWeek:{every:"",weekOfMonth:"",dayOfWeek:[],hour:"",minute:""}},4:{...s,minute:{every:""},hourly:{every:"",minute:""},daily:{every:"",hour:"",minute:""},weekly:{every:String(r.weekly.every),dayOfWeek:r.weekly.dayOfWeek||[]},monthlyDay:{every:"",dayOfMonth:"",hour:"",minute:""},monthlyWeek:{every:"",weekOfMonth:"",dayOfWeek:[],hour:"",minute:""}},5:{...s,minute:{every:""},hourly:{every:"",minute:""},daily:{every:"",hour:"",minute:""},weekly:{every:"",dayOfWeek:[]},monthlyDay:{every:String(r.monthlyDay.every),dayOfMonth:String(r.monthlyDay.dayOfMonth),hour:String(r.monthlyDay.hour),minute:String(r.monthlyDay.minute)},monthlyWeek:{every:"",weekOfMonth:"",dayOfWeek:[],hour:"",minute:""}},6:{...s,minute:{every:""},hourly:{every:"",minute:""},daily:{every:"",hour:"",minute:""},weekly:{every:"",dayOfWeek:[]},monthlyDay:{every:"",dayOfMonth:"",hour:"",minute:""},monthlyWeek:{every:String(r.monthlyWeek.every),weekOfMonth:String(r.monthlyWeek.weekOfMonth),dayOfWeek:[r.monthlyWeek.dayOfWeek],hour:String(r.monthlyWeek.hour),minute:String(r.monthlyWeek.minute)}}}[n]||s},T=async n=>{try{const r=Number(n.frequencyId);if(r===2){const s=n.cronSchedulling.hourly.every,o=n.cronSchedulling.hourly.minute;if(!s||s===""||Number(s)<=0){c("Error",'Para frequência Hourly, o campo "Repeat every" é obrigatório e deve ser maior que 0',"error");return}if(o==null||o===""||Number(o)<0||Number(o)>59){c("Error",'Para frequência Hourly, o campo "Minute" é obrigatório e deve ser entre 0 e 59',"error");return}}else if(r===1){if(!n.cronSchedulling.minute.every){c("Error",'Para frequência Minute, o campo "Every" é obrigatório',"error");return}}else if(r===3){if(!n.cronSchedulling.daily.every||!n.cronSchedulling.daily.hour||!n.cronSchedulling.daily.minute){c("Error",'Para frequência Daily, os campos "Repeat every", "Hour" e "Minute" são obrigatórios',"error");return}}else if(r===4){if(!n.cronSchedulling.weekly.every||!n.cronSchedulling.weekly.dayOfWeek||n.cronSchedulling.weekly.dayOfWeek.length===0){c("Error",'Para frequência Weekly, os campos "Repeat every" e "Day of Week" são obrigatórios',"error");return}}else if(r===5){if(!n.cronSchedulling.monthlyDay.every||!n.cronSchedulling.monthlyDay.dayOfMonth||!n.cronSchedulling.monthlyDay.hour||!n.cronSchedulling.monthlyDay.minute){c("Error","Para frequência Monthly Day, todos os campos são obrigatórios","error");return}}else if(r===6&&(!n.cronSchedulling.monthlyWeek.every||!n.cronSchedulling.monthlyWeek.weekOfMonth||!n.cronSchedulling.monthlyWeek.dayOfWeek||!n.cronSchedulling.monthlyWeek.hour||!n.cronSchedulling.monthlyWeek.minute)){c("Error","Para frequência Monthly Week, todos os campos são obrigatórios","error");return}if(u&&h){const s={frequencyId:n.frequencyId,name:n.name.trim(),priority:n.priority,details:n.details.trim(),projectId:n.projectId,machineId:n.machineId};await v.updateSchedule(Number(h),s),c(l("common.states.success"),l("pages.schedule.updatedSuccess"),"success"),x("/scheduled")}else{const s={frequencyId:Number(n.frequencyId),name:n.name,projectId:Number(n.projectId),machineId:Number(n.machineId),priority:Number(n.priority),details:n.details,arguments:[{name:"default",key:"default",value:"default",order:1}],cronSchedulling:A(Number(n.frequencyId),n.cronSchedulling)};await v.createSchedule(s),c("Success","Schedule created successfully","success"),x("/scheduled")}}catch(r){const s=r.response?.data?.message||"Falha ao salvar schedule";c("Error",s,"error")}},_=()=>{switch(Number(b)){case 1:return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Every (minutes)"}),e.jsx("input",{type:"number",...i("cronSchedulling.minute.every"),className:a})]});case 2:return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Repeat every *"}),e.jsx(m,{name:"cronSchedulling.hourly.every",control:d,rules:{required:"Repeat every é obrigatório",validate:r=>{if(!r||r==="")return"Repeat every é obrigatório";const s=Number(r);return isNaN(s)||s<=0?"Deve ser maior que 0":!0}},render:({field:r,fieldState:s})=>e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",min:"1",step:"1",value:r.value||"",onChange:o=>r.onChange(o.target.value),onBlur:r.onBlur,name:r.name,ref:r.ref,className:a}),s.error&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.error.message})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Minute *"}),e.jsx(m,{name:"cronSchedulling.hourly.minute",control:d,rules:{required:"Minute é obrigatório",validate:r=>{if(r==null||r==="")return"Minute é obrigatório";const s=Number(r);return isNaN(s)||s<0||s>59?"Deve ser entre 0 e 59":!0}},render:({field:r,fieldState:s})=>e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",min:"0",max:"59",step:"1",value:r.value||"",onChange:o=>r.onChange(o.target.value),onBlur:r.onBlur,name:r.name,ref:r.ref,className:a}),s.error&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:s.error.message})]})})]})]});case 3:return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Repeat every *"}),e.jsx("input",{type:"number",...i("cronSchedulling.daily.every"),className:a})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Hour"}),e.jsx("input",{type:"number",...i("cronSchedulling.daily.hour"),className:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Minute"}),e.jsx("input",{type:"number",...i("cronSchedulling.daily.minute"),className:a})]})]})]});case 4:return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Repeat every *"}),e.jsx("input",{type:"number",...i("cronSchedulling.weekly.every"),className:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Day of Week"}),e.jsx(m,{name:"cronSchedulling.weekly.dayOfWeek",control:d,render:({field:r})=>e.jsx("select",{multiple:!0,...r,className:k,children:j.map(s=>e.jsx("option",{value:s,children:s},s))})})]})]});case 5:return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Repeat every *"}),e.jsx("input",{type:"number",...i("cronSchedulling.monthlyDay.every"),className:a})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Day of Month"}),e.jsx("input",{type:"number",...i("cronSchedulling.monthlyDay.dayOfMonth"),className:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Hour"}),e.jsx("input",{type:"number",...i("cronSchedulling.monthlyDay.hour"),className:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Minute"}),e.jsx("input",{type:"number",...i("cronSchedulling.monthlyDay.minute"),className:a})]})]})]});case 6:return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Repeat every *"}),e.jsx("input",{type:"number",...i("cronSchedulling.monthlyWeek.every"),className:a})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Week of Month"}),e.jsx("input",{type:"number",...i("cronSchedulling.monthlyWeek.weekOfMonth"),className:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Day of Week"}),e.jsx("select",{...i("cronSchedulling.monthlyWeek.dayOfWeek"),className:k,children:j.map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Hour"}),e.jsx("input",{type:"number",...i("cronSchedulling.monthlyWeek.hour"),className:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary mb-2",children:"Minute"}),e.jsx("input",{type:"number",...i("cronSchedulling.monthlyWeek.minute"),className:a})]})]})]});default:return null}};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>x("/scheduled"),className:"text-primary hover:text-primary/80 mb-4 font-medium text-base",children:["← ",l("common.buttons.back")]}),e.jsx("h1",{className:"text-4xl font-semibold text-text-primary",children:l(u?"pages.schedule.editSchedule":"pages.schedule.createSchedule")})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 lg:gap-8",children:[e.jsx("aside",{className:"hidden lg:block lg:col-span-1",children:e.jsxs("div",{className:"sticky top-6 rounded-2xl bg-purple border border-purple shadow-card p-6",children:[e.jsx("div",{className:"flex items-center justify-center w-16 h-16 rounded-xl bg-white/20 text-white mb-5",children:e.jsx(L,{className:"w-9 h-9","aria-hidden":!0})}),e.jsx("h2",{className:"text-3xl font-semibold text-white mb-3",children:l(u?"pages.schedule.editSchedule":"pages.schedule.newSchedule")}),e.jsx("div",{className:"text-xl text-white/90 leading-relaxed space-y-4",children:u?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Atualize as informações do agendamento conforme necessário."}),e.jsx("p",{className:"font-medium text-white",children:"Etapas:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-2 pl-1",children:[e.jsx("li",{children:"Altere o nome e o projeto, se precisar."}),e.jsx("li",{children:"Ajuste prioridade e máquina de execução."}),e.jsx("li",{children:"Atualize a frequência e os parâmetros de cron."}),e.jsx("li",{children:"Revise os detalhes e salve."})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Crie um agendamento para executar um projeto automaticamente em uma máquina."}),e.jsx("p",{className:"font-medium text-white",children:"Etapas:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-2 pl-1",children:[e.jsx("li",{children:"Informe o nome e escolha o projeto."}),e.jsx("li",{children:"Defina a prioridade e a máquina de execução."}),e.jsx("li",{children:"Escolha a frequência (minuto, hora, dia, semana ou mês)."}),e.jsx("li",{children:"Preencha os parâmetros de cron para quando a tarefa deve rodar."}),e.jsx("li",{children:"Adicione os detalhes e crie o agendamento."})]})]})})]})}),e.jsxs("form",{onSubmit:D(T),className:"min-w-0 lg:col-span-2 bg-white rounded-2xl shadow-card border border-border p-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(G,{label:l("pages.schedule.name"),required:!0,placeholder:"DOWLOANDS_NFE",error:y.name?.message,...i("name",{required:l("pages.schedule.nameRequired"),minLength:{value:5,message:l("pages.schedule.nameMinLength")}})})}),e.jsx("div",{children:e.jsx(m,{name:"projectId",control:d,rules:{required:l("pages.schedule.projectRequired"),min:{value:1,message:l("pages.schedule.projectRequired")}},render:({field:n})=>e.jsxs(g,{label:l("pages.schedule.project"),required:!0,error:y.projectId?.message,name:n.name,value:n.value,onChange:r=>{if(r!=null&&r.target!=null){const s=Number(r.target.value);Number.isNaN(s)||n.onChange(s)}},onBlur:n.onBlur,ref:n.ref,children:[e.jsx("option",{value:0,children:l("pages.schedule.selectOption")}),W.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})})}),e.jsx("div",{children:e.jsx(m,{name:"priority",control:d,rules:{required:l("pages.schedule.priorityRequired"),min:{value:1,message:l("pages.schedule.priorityRequired")}},render:({field:n})=>e.jsxs(g,{label:l("pages.schedule.priority"),required:!0,error:y.priority?.message,name:n.name,value:n.value,onChange:r=>{if(r!=null&&r.target!=null){const s=Number(r.target.value);Number.isNaN(s)||n.onChange(s)}},onBlur:n.onBlur,ref:n.ref,children:[e.jsx("option",{value:0,children:l("pages.schedule.selectOption")}),I.map(r=>{const s=ne[r.id]??re[r.name],o=s?l(`pages.schedule.priorities.${s}`):r.name;return e.jsx("option",{value:r.id,children:o},r.id)})]})})}),e.jsx("div",{children:e.jsx(m,{name:"frequencyId",control:d,rules:{required:l("pages.schedule.frequencyRequired"),min:{value:1,message:l("pages.schedule.frequencyRequired")}},render:({field:n})=>e.jsxs(g,{label:l("pages.schedule.frequency"),required:!0,error:y.frequencyId?.message,name:n.name,value:n.value,onChange:r=>{if(r!=null&&r.target!=null){const s=Number(r.target.value);Number.isNaN(s)||(n.onChange(s),t("frequencyId",s,{shouldValidate:!0}))}},onBlur:n.onBlur,ref:n.ref,children:[e.jsx("option",{value:0,children:l("pages.schedule.selectOption")}),S.map(r=>{const s=ee[r.id]??X[r.name],o=s?l(`pages.schedule.frequencies.${s}`):r.name;return e.jsx("option",{value:r.id,children:o},r.id)})]})})}),e.jsx("div",{children:e.jsx(m,{name:"machineId",control:d,rules:{required:l("pages.schedule.machineRequired"),min:{value:1,message:l("pages.schedule.machineRequired")}},render:({field:n})=>e.jsxs(g,{label:l("pages.schedule.machine"),required:!0,error:y.machineId?.message,name:n.name,value:n.value,onChange:r=>{if(r!=null&&r.target!=null){const s=Number(r.target.value);Number.isNaN(s)||n.onChange(s)}},onBlur:n.onBlur,ref:n.ref,children:[e.jsx("option",{value:0,children:l("pages.schedule.selectOption")}),O.map(r=>e.jsx("option",{value:r.id,children:r.machineName},r.id))]})})}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(J,{label:l("pages.schedule.details"),required:!0,rows:4,placeholder:l("pages.schedule.detailsPlaceholder"),error:y.details?.message,...i("details",{required:l("pages.schedule.detailsRequired"),minLength:{value:5,message:l("pages.schedule.detailsMinLength")}})})}),Number(b)>0&&e.jsxs("div",{className:"md:col-span-2 border-t border-border-form pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-4",children:l("pages.schedule.cronScheduling")}),_()]})]}),e.jsxs("div",{className:"mt-8 flex justify-end gap-3",children:[e.jsx(f,{variant:"secondary",type:"button",onClick:()=>x("/scheduled"),children:l("common.buttons.cancel")}),e.jsx(f,{type:"submit",children:l(u?"pages.schedule.edit":"pages.schedule.create")})]})]})]})]})}export{he as default};
