import{r as i,x as E,j as e,K as I,h as C,N as M,u as q}from"./vendor-react-GjWeapsa.js";import{d as F}from"./vendor-router-cHSbYr8A.js";import{j as p}from"./job.service-Bn0VNBC8.js";import{u as V}from"./notification.service-DGIhKrzX.js";import{u as z}from"./modal.service-0dNnnw9p.js";import{D as R}from"./DynamicTable-2EKp7iLd.js";import{p as U}from"./projects.service-DTH5gNiz.js";import{p as O}from"./priority.service-CMxhtK8e.js";import{d as $}from"./devices.service-uF7n0LQ8.js";import"./api-Cdl3BoFR.js";function B({isOpen:t,onClose:b}){const[n,f]=i.useState([]),[j,N]=i.useState([]),[x,w]=i.useState([]),[m,y]=i.useState(!1),{register:u,handleSubmit:h,formState:{errors:l},reset:c}=E({defaultValues:{name:"",projectId:0,priorityId:0,machineId:0}});i.useEffect(()=>{t&&(v(),c())},[t,c]);const v=async()=>{try{const[s,g,k]=await Promise.all([U.getProjects(),O.getPriority(),$.getDevices()]);f(s),N(g),w(k)}catch(s){console.error("Erro ao carregar dados:",s)}},S=async s=>{if(!(s.projectId===0||s.priorityId===0||s.machineId===0)){y(!0);try{b({name:s.name,projectId:s.projectId,priorityId:s.priorityId,machineId:s.machineId})}catch(g){console.error("Erro ao criar job:",g)}finally{y(!1)}}};return e.jsx(I,{show:t,as:i.Fragment,children:e.jsxs(C,{as:"div",className:"relative z-50",onClose:()=>b(null),children:[e.jsx(I.Child,{as:i.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:e.jsx(I.Child,{as:i.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsx(C.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-lg bg-white p-6 text-left align-middle shadow-xl transition-all",children:e.jsxs("form",{onSubmit:h(S),children:[e.jsxs("div",{className:"flex flex-col items-center text-center mb-4",children:[e.jsx(M,{className:"h-12 w-12 text-primary mb-3"}),e.jsx(C.Title,{as:"h3",className:"text-lg font-semibold leading-6 text-gray-900 mb-4",children:"Create Job"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",...u("name",{required:"Name is required"}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Enter job name"}),l.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.name.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Project ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{...u("projectId",{required:"Project is required",min:{value:1,message:"Project is required"}}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:0,children:"Select a project..."}),n.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),l.projectId&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.projectId.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Priority ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{...u("priorityId",{required:"Priority is required",min:{value:1,message:"Priority is required"}}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:0,children:"Select a priority..."}),j.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),l.priorityId&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.priorityId.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Machine ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{...u("machineId",{required:"Machine is required",min:{value:1,message:"Machine is required"}}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:0,children:"Select a machine..."}),x.map(s=>e.jsx("option",{value:s.id,children:s.machineName},s.id))]}),l.machineId&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.machineId.message})]})]}),e.jsxs("div",{className:"mt-6 flex gap-3",children:[e.jsx("button",{type:"button",className:"inline-flex justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2",onClick:()=>b(null),disabled:m,children:"Cancel"}),e.jsx("button",{type:"submit",className:"inline-flex justify-center rounded-md bg-primary px-4 py-2 text-sm font-medium text-white hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",disabled:m,children:m?"Creating...":"Create"})]})]})})})})})]})})}function ee(){const{t}=q("translation"),b=F(),n=V(r=>r.showToast),f=z(r=>r.confirmDelete),[j,N]=i.useState([]),[x,w]=i.useState(0),[m,y]=i.useState("PageNumber=1&PageSize=5&SortField=id&SortOrder=asc"),[u,h]=i.useState(!1),[l,c]=i.useState([]),v=i.useMemo(()=>[{key:"_select",label:"",type:"checkbox"},{key:"Name",label:t("pages.jobs.columnName"),filterable:!0,sortable:!1,filterType:"text"},{key:"HostName",label:t("pages.jobs.hostName"),filterable:!0,sortable:!1,filterType:"text"},{key:"ProjectName",label:t("pages.jobs.projectName"),filterable:!0,sortable:!1,filterType:"text"},{key:"MachineUser",label:t("pages.jobs.machineUser"),filterable:!0,sortable:!1,filterType:"text"},{key:"State",label:t("pages.jobs.state"),filterable:!1,sortable:!1,filterType:"text"},{key:"Priority",label:t("pages.jobs.priority"),filterable:!0,sortable:!1,filterType:"text"},{key:"PackageVersion",label:t("pages.jobs.robotVersion"),filterable:!0,sortable:!1,filterType:"text"},{key:"StartedAt",label:t("pages.jobs.startedAt"),filterable:!1,sortable:!0,filterType:"text"},{key:"EndedAt",label:t("pages.jobs.endedAt"),filterable:!1,sortable:!1,filterType:"text"},{key:"actions",label:t("common.actions.label"),type:"action"}],[t]),S=i.useMemo(()=>[{label:t("pages.jobs.preview"),action:"preview",icon:"preview"},{label:t("pages.jobs.execute"),action:"execute",icon:"play"},{label:t("common.buttons.delete"),action:"delete",icon:"trash"}],[t]);i.useEffect(()=>{s()},[m]);const s=async()=>{try{const r=await p.getAllJobs(m);w(r.totalItems),N(r.items.map(a=>({id:a.id,Name:a.name,HostName:a.hostname,MachineUser:a.machineUser,State:a.state,Priority:a.priority,StartedAt:a.started,EndedAt:a.ended,Robot:a.robot,PackageVersion:a.packageVersion,ProjectName:a.projectName})))}catch(r){console.error("Erro ao carregar jobs:",r)}},g=async r=>{switch(r.action){case"preview":b(`/job-details/${r.item.id}`);break;case"execute":await J(r.item.id);break;case"delete":await k(r.item);break}},k=async r=>{if(await f({itemName:r.Name??`Job #${r.id}`}))try{await p.deleteJob(r.id),n(t("common.states.success"),t("pages.jobs.deleteSuccess"),"success"),c(o=>o.filter(d=>d!==r.id)),s()}catch(o){const d=o.response?.data?.message??t("pages.jobs.deleteError");n(t("common.states.error"),d,"error")}},P=async()=>{if(l.length===0||!await f({itemName:`${l.length} job(s)`,description:t("pages.jobs.deleteSelectedConfirmDescription")}))return;let a=0,o=0;for(const d of l)try{await p.deleteJob(d),a++}catch{o++}c([]),s(),o===0?n(t("common.states.success"),t("pages.jobs.deleteMultipleSuccess",{count:a}),"success"):n(t("common.warning"),t("pages.jobs.deleteMultiplePartial",{ok:a,fail:o}),"error")},T=(r,a)=>{c(o=>a?[...o,r]:o.filter(d=>d!==r))},A=async()=>{if(await f({itemName:t("pages.jobs.deleteAllConfirmItemName"),description:t("pages.jobs.deleteAllConfirmDescription"),buttonName:t("pages.jobs.deleteAllConfirmButton")}))try{const a=await p.deleteAllJobs();c([]),s(),n(t("common.states.success"),t("pages.jobs.clearAllSuccess",{count:a.deletedCount}),"success")}catch(a){const o=a.response?.data?.message??t("pages.jobs.deleteError");n(t("common.states.error"),o,"error")}},J=async r=>{try{await p.executeJob(r),n(t("common.states.success"),t("pages.jobs.executeSuccess"),"success"),s()}catch(a){const o=a.response?.data?.message||t("pages.jobs.deleteError");n(t("common.states.error"),o,"error")}},D=async r=>{if(!r){h(!1);return}try{await p.createJob(r),n(t("common.states.success"),t("pages.jobs.createSuccess"),"success"),h(!1),s()}catch(a){const o=a.response?.data?.message||t("pages.jobs.createError");n(t("common.states.error"),o,"error")}};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsxs("div",{className:"flex flex-wrap justify-between items-center gap-4 mb-8",children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-semibold text-text-primary",children:t("pages.jobs.title")}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx("button",{type:"button",onClick:A,disabled:x===0,className:"inline-flex items-center justify-center px-5 py-2.5 rounded-xl font-medium text-white bg-red-700 hover:bg-red-800 shadow-sm hover:shadow transition-all duration-200 border border-red-800 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-red-700",title:t(x===0?"pages.jobs.noJobsToDelete":"pages.jobs.deleteAllConfirmTitle"),children:t("pages.jobs.deleteAll")}),l.length>0&&e.jsx("button",{type:"button",onClick:P,className:"inline-flex items-center justify-center px-5 py-2.5 rounded-xl font-medium text-white bg-red-600 hover:bg-red-700 shadow-sm hover:shadow transition-all duration-200",children:t("pages.jobs.deleteSelected",{count:l.length})}),e.jsx("button",{onClick:()=>h(!0),className:"inline-flex items-center justify-center px-5 py-2.5 rounded-xl font-medium text-white bg-orange hover:bg-orange/90 shadow-sm hover:shadow transition-all duration-200",children:t("common.buttons.create")})]})]}),e.jsx("section",{className:"mt-6",children:e.jsx(R,{columns:v,data:j,totalItems:x,pageSize:5,pageSizeOptions:[5,10,25,100],showFirstLastButtons:!0,actionMenuItems:S,onActionClick:g,onQueryParamsChange:y,selectedRowIds:l,onSelectionChange:T})}),e.jsx(B,{isOpen:u,onClose:D})]})}export{ee as default};
