import{d as O,w as L}from"./vendor-router-cHSbYr8A.js";import{u as R,r,j as t}from"./vendor-react-GjWeapsa.js";import{p as k,a as U}from"./packagesVersions.service-FNVeQxB5.js";import{u as x}from"./modal.service-0dNnnw9p.js";import{u as z}from"./notification.service-DGIhKrzX.js";import{D as A}from"./DynamicTable-2EKp7iLd.js";import"./api-Cdl3BoFR.js";const F={downloadBlobFile:(a,i)=>{const l=window.URL.createObjectURL(a),n=document.createElement("a");n.href=l,n.download=i,n.click(),window.URL.revokeObjectURL(l)}},u="[Packages]";function _(){const{t:a}=R("translation"),i=O(),l=x(e=>e.confirmDownload),n=x(e=>e.confirmDelete),d=z(e=>e.showToast),[h,y]=r.useState([]),[N,S]=r.useState(0),[f,j]=r.useState("PageNumber=1&PageSize=5&SortField=id&SortOrder=asc"),[m,p]=r.useState(!1),v=r.useMemo(()=>[{key:"Name",label:a("pages.assets.name"),filterable:!0,sortable:!1,filterType:"text"},{key:"Description",label:a("pages.assets.description"),filterable:!0,sortable:!1,filterType:"text"},{key:"PackageVersion",label:a("pages.automation.columnPackageVersion"),filterable:!0,sortable:!1,filterType:"text"},{key:"actions",label:a("common.actions.label"),type:"action"}],[a]),P=r.useMemo(()=>[{label:a("pages.packages.download"),action:"download",icon:"download"},{label:a("pages.packages.upgrade")||"Upgrade",action:"edit",icon:"edit"},{label:a("common.actions.delete")||"Excluir",action:"delete",icon:"trash"}],[a]);r.useEffect(()=>{w()},[f]);const w=async()=>{try{const e=await k.getAllPackages(f);S(e.totalItems),y(e.items.map(s=>({id:s.id,Name:s.name,Description:s.description,PackageVersion:s.packageVersions?.map(o=>o.version).join(", ")??"",rawPackageVersions:s.packageVersions??[]})))}catch(e){console.error("Erro ao carregar packages:",e)}},D=async e=>{switch(e.action){case"download":await C(e.item);break;case"edit":E(e.item);break;case"delete":await V(e.item);break}},E=e=>{console.log(u,"edit (upgrade)",e?.id,e?.Name),i("/packages/upload",{state:{isNew:!1,packageId:e.id}})},V=async e=>{const s=e?.Name??`#${e?.id}`;if(console.log(u,"delete",e?.id,s),!!await n({itemName:s}))try{await k.deletePackage(e.id),d("Success",a("pages.packages.deleteSuccess"),"success"),w()}catch(c){console.error(u,"delete error",c);const g=c?.response?.data,T=g?.extensions?.errorDescription??g?.detail??g?.title??c?.message??a("pages.packages.deleteError");d("Error",String(T),"error")}},C=async e=>{const s=await l({title:`Download - ${e.Name}`,versions:e.rawPackageVersions.map(o=>({id:o.id,version:o.version}))});if(s)try{const o=await U.getDownloadPackage(s.id),c=`v${s.version}-${e.Name}.zip`;F.downloadBlobFile(o,c),d("Success","Download completed successfully","success")}catch{d("Error","Failed to download package","error")}},b=e=>{i("/packages/upload",{state:{isNew:e}})};return t.jsxs("div",{className:"min-h-screen bg-background",children:[t.jsxs("div",{className:"flex flex-wrap justify-between items-center gap-4 mb-8",children:[t.jsx("h1",{className:"text-3xl sm:text-4xl font-semibold text-text-primary",children:a("pages.packages.title")}),t.jsxs("div",{className:"relative",children:[t.jsxs("button",{onClick:()=>p(!m),className:"inline-flex items-center justify-center px-5 py-2.5 rounded-xl font-medium text-white bg-orange hover:bg-orange/90 shadow-sm hover:shadow transition-all duration-200",children:[a("pages.packages.upload"),t.jsx("span",{className:`ml-1 transform transition-transform ${m?"rotate-180":""}`,children:"â–¼"})]}),m&&t.jsxs("div",{className:"absolute right-0 mt-2 bg-white rounded-xl shadow-card border border-border z-10 min-w-[120px] py-1",children:[t.jsx("button",{onClick:()=>{b(!0),p(!1)},className:"block w-full text-left px-4 py-2.5 text-text-primary hover:bg-gray-50 rounded-t-xl transition-colors",children:a("pages.packages.new")}),t.jsx("button",{onClick:()=>{b(!1),p(!1)},className:"block w-full text-left px-4 py-2.5 text-text-primary hover:bg-gray-50 rounded-b-xl transition-colors",children:a("pages.packages.upgrade")})]})]})]}),t.jsx("section",{className:"mt-6",children:t.jsx(A,{columns:v,data:h,totalItems:N,pageSize:5,pageSizeOptions:[5,10,25,100],showFirstLastButtons:!0,actionMenuItems:P,onActionClick:D,onQueryParamsChange:j})})]})}const H=L(function(){return t.jsx(_,{})});export{H as default};
