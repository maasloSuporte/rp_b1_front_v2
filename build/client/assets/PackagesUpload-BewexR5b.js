import{r as i,v as L,j as s,D as O}from"./vendor-react-D3RE0R8o.js";import{d as U,u as z}from"./vendor-router-C5YTkdq4.js";import{p,a as y}from"./packagesVersions.service-Di9Xz39b.js";import{a as R}from"./api-BB9j10S9.js";import{u as B}from"./notification.service-CvsIel6B.js";const A={getTechnology:async()=>(await R.get("/technologies/all")).data};function G(){const n=U(),b=z(),d=B(e=>e.showToast),[k,j]=i.useState([]),[N,v]=i.useState([]),[u,x]=i.useState(null),[h,P]=i.useState(null),r=b.state?.isNew!==!1,{register:o,handleSubmit:w,formState:{errors:t},setValue:l,watch:S,clearErrors:f}=L({defaultValues:{name:"",description:"",technologyId:0,packageId:0,version:"",file:null}}),m=S("packageId"),g=o("file",{required:"File is required"});i.useEffect(()=>{I(),r||q()},[r]),i.useEffect(()=>{m>0&&!r&&T(m)},[m,r]);const I=async()=>{try{const e=await A.getTechnology();v(e)}catch(e){console.error("Erro ao carregar tecnologias:",e)}},q=async()=>{try{const e=await p.getPackageCompany();j(e)}catch(e){console.error("Erro ao carregar packages:",e)}},T=async e=>{try{const a=await p.getByIdPackage(e);l("name",a.name),l("description",a.description),l("technologyId",a.technology),P(e)}catch(a){console.error("Erro ao carregar package:",a)}},D=e=>{e.target.files&&e.target.files.length>0&&(x(e.target.files[0].name),f("file"))},F=e=>{e.preventDefault(),e.stopPropagation()},V=e=>{if(e.preventDefault(),e.stopPropagation(),e.dataTransfer.files&&e.dataTransfer.files.length>0){const a=e.dataTransfer.files[0];x(a.name);const c=new DataTransfer;c.items.add(a),l("file",c.files,{shouldValidate:!0}),f("file")}},C=async e=>{try{if(r){const a={name:e.name,description:e.description,technologyId:e.technologyId},c=await p.createPackege(a);if(e.file&&e.file.length>0){const E={version:e.version,file:e.file[0],packageId:c.id,description:e.description};await y.createPackageVersion(E),d("Sucess","Package create successfully","success"),n("/packages")}}else if(e.file&&e.file.length>0&&h){const a={version:e.version,file:e.file[0],packageId:h,description:e.description};await y.createPackageVersion(a),d("Sucess","Package version update successfully","success"),n("/packages")}}catch(a){const c=a.response?.data?.message||"Falha ao fazer upload do package";d("Error",c,"error")}};return s.jsxs("div",{className:"min-h-screen bg-background",children:[s.jsxs("div",{className:"mb-6",children:[s.jsx("button",{onClick:()=>n("/packages"),className:"text-primary hover:text-primary/80 mb-4",children:"â† Voltar"}),s.jsx("h1",{className:"text-4xl font-semibold text-text-primary",children:"Upload Packages"})]}),s.jsxs("form",{onSubmit:w(C),className:"bg-white rounded-lg shadow-card p-6",children:[s.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[r&&s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Package Name ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"text",...o("name",{required:r?"Package name is required":!1,minLength:{value:5,message:"Package name must be at least 5 characters"}}),placeholder:"DOWLOANDS_NFE",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"}),t.name&&s.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.name.message})]}),!r&&s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Package ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsxs("select",{...o("packageId",{required:r?!1:"Package is required",min:{value:1,message:"Package is required"}}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary",children:[s.jsx("option",{value:0,children:"Filter the package..."}),k.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),t.packageId&&s.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.packageId.message})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Description ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("textarea",{...o("description",{required:"Description is required",minLength:{value:5,message:"Description must be at least 5 characters"}}),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"}),t.description&&s.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.description.message})]}),r&&s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Technology ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsxs("select",{...o("technologyId",{required:r?"Technology is required":!1,min:{value:1,message:"Technology is required"}}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary",children:[s.jsx("option",{value:0,children:"Filter the technology..."}),N.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),t.technologyId&&s.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.technologyId.message})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Version ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"text",...o("version",{required:"Version is required",pattern:{value:/^\d+\.\d+\.\d+$/,message:"Version must be in format X.Y.Z (e.g., 1.0.0)"}}),placeholder:"1.0.0",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"}),t.version&&s.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.version.message})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["File ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsxs("div",{onDragOver:F,onDrop:V,className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-primary transition-colors",children:[s.jsx(O,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),s.jsx("input",{type:"file",...g,onChange:e=>{g.onChange&&g.onChange(e),D(e)},className:"hidden",id:"file-upload",accept:".zip,.rar,.7z"}),s.jsx("label",{htmlFor:"file-upload",className:"cursor-pointer text-primary hover:text-primary/80 font-medium",children:"Click to upload or drag and drop"}),u&&s.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["Selected: ",u]}),t.file&&s.jsx("p",{className:"mt-2 text-sm text-red-600",children:t.file.message})]})]})]}),s.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[s.jsx("button",{type:"button",onClick:()=>n("/packages"),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),s.jsx("button",{type:"submit",className:"px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90",children:r?"Create":"Upgrade"})]})]})]})}export{G as default};
