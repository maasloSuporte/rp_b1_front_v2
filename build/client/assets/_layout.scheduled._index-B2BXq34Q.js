import{d as T,w as C}from"./vendor-router-cHSbYr8A.js";import{u as D,r,j as i}from"./vendor-react-GjWeapsa.js";import{s as f}from"./schedule.service-C92pRfiQ.js";import{p as F}from"./priority.service-CMxhtK8e.js";import{f as v}from"./frequency.service-DLKu-kq6.js";import{u as _}from"./modal.service-0dNnnw9p.js";import{u as M}from"./notification.service-DGIhKrzX.js";import{D as A}from"./DynamicTable-2EKp7iLd.js";import"./api-Cdl3BoFR.js";function P(e){if(!e)return"—";try{return new Date(e).toLocaleString(void 0,{dateStyle:"short",timeStyle:"short"})}catch{return String(e)}}const R={"Every Minute":"everyMinute",Hourly:"hourly",Daily:"daily",Weekly:"weekly","Monthly by Day":"monthlyByDay","Monthly by Week":"monthlyByWeek","Custom Cron":"customCron"},Y={1:"everyMinute",2:"hourly",3:"daily",4:"weekly",5:"monthlyByDay",6:"monthlyByWeek",7:"customCron"},O={Low:"low",Medium:"medium",High:"high",Critical:"critical"},K={1:"low",2:"medium",3:"high",4:"critical"};function B(){const{t:e}=D("translation"),o=T(),h=_(t=>t.confirmDelete),u=M(t=>t.showToast),[m,x]=r.useState([]),[y,g]=r.useState(0),[p,b]=r.useState("PageNumber=1&PageSize=10&SortField=nextExecution&SortOrder=asc"),[n,S]=r.useState([]),[c,N]=r.useState([]),E=r.useMemo(()=>[{key:"name",label:e("pages.scheduled.activityName"),filterable:!0,sortable:!0,filterType:"text"},{key:"frequencyName",label:e("pages.scheduled.frequency"),filterable:!1,sortable:!1,filterType:"text"},{key:"nextExecution",label:e("pages.scheduled.nextExecution"),filterable:!1,sortable:!0,filterType:"text"},{key:"priorityName",label:e("pages.scheduled.priority"),filterable:!0,sortable:!1,filterType:"text"},{key:"details",label:e("pages.scheduled.details"),filterable:!1,sortable:!1,filterType:"text"},{key:"actions",label:e("common.actions.label"),type:"action"}],[e]),q=r.useMemo(()=>[{label:e("common.buttons.edit"),action:"edit",icon:"edit"},{label:e("pages.assets.deleted"),action:"deleted",icon:"deleted"}],[e]);r.useEffect(()=>{(async()=>{try{const[a,s]=await Promise.all([F.getPriority(),v.getFrequency()]);S(a??[]),N(s??[])}catch(a){console.error("Erro ao carregar prioridades/frequências:",a)}})()},[]);const l=async()=>{try{const t=await f.getAllSchedule(p);g(t.totalItems??0);const a=t.items??[];x(a.map(s=>{const w=c.find(d=>d.id===s.frequencyId),j=n.find(d=>d.id===Number(s.priority));return{id:s.id,name:s.name??"—",frequencyId:s.frequencyId,frequencyNameFromApi:w?.name??"—",nextExecution:P(s.nextExecution),nextExecutionRaw:s.nextExecution,priorityId:Number(s.priority),priorityNameFromApi:j?.name??"—",details:s.details??"—"}}))}catch(t){console.error("Erro ao buscar schedules:",t)}};r.useEffect(()=>{l()},[p]),r.useEffect(()=>{(n.length>0||c.length>0)&&l()},[n.length,c.length]);const k=r.useMemo(()=>m.map(t=>{const a=Y[t.frequencyId]??R[t.frequencyNameFromApi],s=K[t.priorityId]??O[t.priorityNameFromApi];return{...t,frequencyName:a?e(`pages.schedule.frequencies.${a}`):t.frequencyNameFromApi??"—",priorityName:s?e(`pages.schedule.priorities.${s}`):t.priorityNameFromApi??"—"}}),[m,e]),I=async t=>{switch(t.action){case"edit":o(`/scheduled/${t.item.id}`);break;case"deleted":if(await h({itemName:t.item.name}))try{await f.deleteSchedule({id:t.item.id}),u(e("common.states.success"),e("pages.scheduled.deleteSuccess"),"success"),l()}catch{u(e("common.states.error"),e("pages.scheduled.deleteError"),"error")}break}};return i.jsxs("div",{className:"min-h-screen bg-background",children:[i.jsxs("div",{className:"mb-6",children:[i.jsx("h1",{className:"text-3xl sm:text-4xl font-semibold text-text-primary",children:e("pages.scheduled.title")}),i.jsx("p",{className:"mt-1 text-base text-text-secondary",children:e("pages.scheduled.subtitle")})]}),i.jsxs("div",{className:"flex flex-wrap justify-between items-center gap-4 mb-4",children:[i.jsxs("p",{className:"text-sm text-text-secondary",children:[e("pages.scheduled.activitiesCount")," (",y,")"]}),i.jsx("button",{onClick:()=>o("/scheduled/create"),className:"inline-flex items-center justify-center px-5 py-2.5 rounded-xl font-medium text-white bg-orange hover:bg-orange/90 shadow-sm hover:shadow transition-all duration-200",children:e("pages.scheduled.createSchedule")})]}),i.jsx("section",{className:"mt-4",children:i.jsx(A,{columns:E,data:k,totalItems:y,pageSize:10,pageSizeOptions:[5,10,25,100],showFirstLastButtons:!0,initialSortField:"nextExecution",initialSortOrder:"asc",actionMenuItems:q,onActionClick:I,onQueryParamsChange:b})})]})}const V=C(function(){return i.jsx(B,{})});export{V as default};
