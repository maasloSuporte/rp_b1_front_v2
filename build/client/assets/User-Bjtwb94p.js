import{r as b,v as F,j as e}from"./vendor-react-D3RE0R8o.js";import{c as T,d as A}from"./vendor-router-C5YTkdq4.js";import{u as f}from"./users.service-CI0k8rR4.js";import{r as $}from"./roles.service-CRlzX88Y.js";import{c as V}from"./companyUser.service-BerwkOpn.js";import{a as B}from"./api-BB9j10S9.js";const D={createUserRole:async a=>{await B.post("/userRoles",a)}};function K(){const{id:a}=T(),x=A(),i=!!a,[h,j]=b.useState([]),[n,d]=b.useState([]),[m,l]=b.useState([]),{register:c,handleSubmit:v,formState:{errors:t},setValue:u,watch:y}=F({defaultValues:{name:"",cpf:"",email:"",password:"",confirmPassword:"",phoneNumber:""}}),p=y("password"),g=y("confirmPassword");b.useEffect(()=>{k(),i&&a&&w(a)},[a,i]);const w=async s=>{try{const r=await f.getByIdUser(s);console.log(r),u("name",r.name),u("cpf",r.cpf),u("email",r.email),u("phoneNumber",r.phoneNumber)}catch(r){console.error("Erro ao carregar usuário:",r)}},k=async()=>{try{const s=await $.getAllRoles();j(s)}catch(s){console.error("Erro ao carregar roles:",s)}},N=s=>{l(r=>r.includes(s)?r.filter(o=>o!==s):[...r,s])},S=s=>{n.includes(s)||d(r=>[...r,s]),l(r=>r.filter(o=>o!==s))},R=s=>{d(r=>r.filter(o=>o!==s)),l(r=>r.filter(o=>o!==s))},U=()=>{m.forEach(s=>{n.includes(s)||d(r=>[...r,s])}),l([])},C=()=>{d(s=>s.filter(r=>!m.includes(r))),l([])},P=s=>{const r=h.find(o=>o.id===s);return r?r.name:`Role ${s}`},E=h.filter(s=>!n.includes(s.id)),q=async s=>{if(p!==g){alert("As senhas não coincidem");return}if(n.length===0){alert("Selecione pelo menos um role");return}try{if(i&&a){const r={name:s.name,phoneNumber:s.phoneNumber};await f.updateUser(a,r),alert("Usuário atualizado com sucesso"),x("/users")}else{const r={name:s.name,cpf:s.cpf,email:s.email,password:s.password,phoneNumber:s.phoneNumber},o=await f.createUser(r);await V.createCompanyUser({userId:o.id,active:!0}),await D.createUserRole({userId:o.id,roleId:n}),alert("Usuário criado com sucesso"),x("/users")}}catch(r){const o=r.response?.data?.message||"Falha ao salvar usuário";alert(`Erro: ${o}`)}};return e.jsxs("div",{className:"px-4 py-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("button",{onClick:()=>x("/users"),className:"text-indigo-600 hover:text-indigo-900 mb-4",children:"← Voltar"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:i?"Edit User":"Create User"})]}),e.jsxs("form",{onSubmit:v(q),className:"bg-white shadow rounded-lg p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Name"}),e.jsx("input",{type:"text",...c("name",{required:"Nome é obrigatório"}),className:"mt-1 block w-full px-3 py-3 text-base border-0 border-b-2 border-gray-300 bg-transparent focus:outline-none focus:border-indigo-600 focus:ring-0 transition-colors"}),t.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"CPF"}),e.jsx("input",{type:"text",...c("cpf",{required:"CPF é obrigatório"}),disabled:i,className:"mt-1 block w-full px-3 py-3 text-base border-0 border-b-2 border-gray-300 bg-transparent focus:outline-none focus:border-indigo-600 focus:ring-0 transition-colors disabled:bg-gray-50 disabled:border-gray-200"}),t.cpf&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.cpf.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),e.jsx("input",{type:"email",...c("email",{required:"Email é obrigatório"}),disabled:i,className:"mt-1 block w-full px-3 py-3 text-base border-0 border-b-2 border-gray-300 bg-transparent focus:outline-none focus:border-indigo-600 focus:ring-0 transition-colors disabled:bg-gray-50 disabled:border-gray-200"}),t.email&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Phone Number"}),e.jsx("input",{type:"text",...c("phoneNumber",{required:"Telefone é obrigatório"}),className:"mt-1 block w-full px-3 py-3 text-base border-0 border-b-2 border-gray-300 bg-transparent focus:outline-none focus:border-indigo-600 focus:ring-0 transition-colors"}),t.phoneNumber&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.phoneNumber.message})]}),!i&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Password"}),e.jsx("input",{type:"password",...c("password",{required:"Senha é obrigatória"}),className:"mt-1 block w-full px-3 py-3 text-base border-0 border-b-2 border-gray-300 bg-transparent focus:outline-none focus:border-indigo-600 focus:ring-0 transition-colors"}),t.password&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.password.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Confirm Password"}),e.jsx("input",{type:"password",...c("confirmPassword",{required:"Confirmação de senha é obrigatória"}),className:"mt-1 block w-full px-3 py-3 text-base border-0 border-b-2 border-gray-300 bg-transparent focus:outline-none focus:border-indigo-600 focus:ring-0 transition-colors"}),t.confirmPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.confirmPassword.message}),p&&g&&p!==g&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:"As senhas não coincidem"})]})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-4",children:"Roles"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Available Roles"}),e.jsx("div",{className:"border rounded-md p-2 h-64 overflow-y-auto",children:E.map(s=>e.jsx("div",{className:`p-2 mb-1 rounded cursor-pointer ${m.includes(s.id)?"bg-indigo-100":"hover:bg-gray-100"}`,onClick:()=>N(s.id),onDoubleClick:()=>S(s.id),children:s.name},s.id))})]}),e.jsxs("div",{className:"flex flex-col justify-center items-center gap-2",children:[e.jsx("button",{type:"button",onClick:U,className:"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700",children:"→"}),e.jsx("button",{type:"button",onClick:C,className:"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700",children:"←"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Selected Roles"}),e.jsx("div",{className:"border rounded-md p-2 h-64 overflow-y-auto",children:n.map(s=>e.jsx("div",{className:`p-2 mb-1 rounded cursor-pointer ${m.includes(s)?"bg-indigo-100":"hover:bg-gray-100"}`,onClick:()=>N(s),onDoubleClick:()=>R(s),children:P(s)},s))})]})]})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{type:"submit",className:"bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:i?"Update":"Create"})})]})]})}export{K as default};
